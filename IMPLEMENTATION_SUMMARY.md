# Zabbix 6.0/7.0 å¤šç‰ˆæœ¬æ”¯æŒå®žçŽ°æ€»ç»“

## ðŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æˆåŠŸå®žçŽ°äº† Zabbix 6.0 å’Œ 7.0 çš„å¤šç‰ˆæœ¬æ”¯æŒï¼Œæä¾›äº†è‡ªåŠ¨ç‰ˆæœ¬æ£€æµ‹ã€é€‚é…å™¨æ¨¡å¼å’Œå‘åŽå…¼å®¹æ€§ã€‚

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. åŸºç¡€æž¶æž„å®žçŽ° âœ…

#### ç‰ˆæœ¬ç®¡ç†å™¨ (VersionManager)
- **æ–‡ä»¶**: `base.go`
- **åŠŸèƒ½**:
  - è‡ªåŠ¨æ£€æµ‹ Zabbix æœåŠ¡å™¨ç‰ˆæœ¬
  - ç‰ˆæœ¬è§£æžå’Œæ¯”è¾ƒ
  - ç‰¹æ€§æ”¯æŒæ£€æµ‹
  - ç‰ˆæœ¬å…¼å®¹æ€§éªŒè¯

#### é€‚é…å™¨æ¨¡å¼
- **æ–‡ä»¶**: `base.go`
- **å®žçŽ°çš„é€‚é…å™¨**:
  - `Zabbix6ItemAdapter` - Zabbix 6.0 ç›‘æŽ§é¡¹é€‚é…å™¨
  - `Zabbix7ItemAdapter` - Zabbix 7.0 ç›‘æŽ§é¡¹é€‚é…å™¨
  - `Zabbix6HostAdapter` - Zabbix 6.0 ä¸»æœºé€‚é…å™¨
  - `Zabbix7HostAdapter` - Zabbix 7.0 ä¸»æœºé€‚é…å™¨

#### ç»Ÿä¸€æ•°æ®ç»“æž„
- **æ–‡ä»¶**: `item.go`, `host.go`
- **æ”¯æŒçš„å¤šç‰ˆæœ¬å­—æ®µ**:
  - `HeadersV6` / `HeadersV7` - ä¸åŒç‰ˆæœ¬çš„ headers æ ¼å¼
  - `ProxyHostID` / `ProxyID` - ä¸åŒç‰ˆæœ¬çš„ä»£ç†å­—æ®µ
  - `MonitoredBy` - Zabbix 7.0+ ç›‘æŽ§æ–¹å¼å­—æ®µ
  - `QueryFieldsV6` / `QueryFieldsV7` - æŸ¥è¯¢å­—æ®µæ ¼å¼

### 2. ç‰ˆæœ¬æ£€æµ‹å’Œè‡ªé€‚åº”åŠŸèƒ½ âœ…

#### è‡ªåŠ¨ç‰ˆæœ¬æ£€æµ‹
```go
// ç™»å½•æ—¶è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬
api := NewAPI(config)
auth, err := api.Login("admin", "password")
// ç‰ˆæœ¬æ£€æµ‹å’Œé€‚é…å™¨åˆå§‹åŒ–è‡ªåŠ¨å®Œæˆ
```

#### æ‰‹åŠ¨ç‰ˆæœ¬æŽ§åˆ¶
```go
// å¼ºåˆ¶æŒ‡å®šç‰ˆæœ¬ (ç”¨äºŽæµ‹è¯•)
err := api.ForceVersion("7.0.0")

// ä¸è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬çš„ç™»å½•
auth, err := api.LoginWithoutVersionInit("admin", "password")
err = api.InitializeVersionSupport()
```

#### ç‰¹æ€§æ£€æµ‹
```go
// æ£€æŸ¥ç‰¹æ€§æ”¯æŒ
if api.IsFeatureSupported(zabbix.FeatureHistoryPush) {
    // ä½¿ç”¨ History Push API
}

if api.SupportsMFA() {
    // ä½¿ç”¨ MFA åŠŸèƒ½
}
```

### 3. Zabbix 7.0 ç‰¹æœ‰åŠŸèƒ½å®žçŽ° âœ…

#### MFA (å¤šå› å­è®¤è¯) æ”¯æŒ
- **æ–‡ä»¶**: `mfa.go`
- **å®žçŽ°çš„åŠŸèƒ½**:
  - `MFACreate()` - åˆ›å»º MFA é…ç½®
  - `MFAGet()` - èŽ·å– MFA é…ç½®
  - `MFAUpdate()` - æ›´æ–° MFA é…ç½®
  - `MFADelete()` - åˆ é™¤ MFA é…ç½®
  - `UserResetTOTP()` - é‡ç½®ç”¨æˆ· TOTP

#### Proxy Group æ”¯æŒ
- **æ–‡ä»¶**: `proxy_group.go`
- **å®žçŽ°çš„åŠŸèƒ½**:
  - `ProxyGroupCreate()` - åˆ›å»ºä»£ç†ç»„
  - `ProxyGroupGet()` - èŽ·å–ä»£ç†ç»„
  - `ProxyGroupUpdate()` - æ›´æ–°ä»£ç†ç»„
  - `ProxyGroupDelete()` - åˆ é™¤ä»£ç†ç»„
  - å¢žå¼ºçš„ Proxy ç»“æž„ (Zabbix 7.0+)

#### Browser Item ç±»åž‹
- **æ–‡ä»¶**: `item.go`
- **å®žçŽ°çš„åŠŸèƒ½**:
  - `CreateBrowserItems()` - åˆ›å»ºæµè§ˆå™¨ç›‘æŽ§é¡¹
  - `GetBrowserItems()` - èŽ·å–æµè§ˆå™¨ç›‘æŽ§é¡¹
  - `ValidateBrowserItem()` - éªŒè¯æµè§ˆå™¨ç›‘æŽ§é¡¹
  - Browser Item ä¸“ç”¨å­—æ®µæ”¯æŒ

#### History Push API
- **æ–‡ä»¶**: `base.go`
- **å®žçŽ°çš„åŠŸèƒ½**:
  - `HistoryPush()` - æŽ¨é€åŽ†å²æ•°æ®
  - `HistoryData` ç»“æž„ä½“
  - ç‰¹æ€§æ£€æµ‹å’Œç‰ˆæœ¬å…¼å®¹

### 4. å¤šç‰ˆæœ¬æµ‹è¯•ç”¨ä¾‹ âœ…

#### å•å…ƒæµ‹è¯•
- **æ–‡ä»¶**: `multiversion_test.go`
- **æµ‹è¯•è¦†ç›–**:
  - ç‰ˆæœ¬ç®¡ç†å™¨åŠŸèƒ½
  - ç‰¹æ€§æ£€æµ‹é€»è¾‘
  - Header æ ¼å¼è½¬æ¢
  - Item å’Œ Host éªŒè¯
  - Browser Item éªŒè¯
  - ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
  - é€‚é…å™¨æŽ¥å£æµ‹è¯•

#### é›†æˆæµ‹è¯•
- **æ–‡ä»¶**: `integration_test.go`
- **æµ‹è¯•è¦†ç›–**:
  - å¤šç‰ˆæœ¬åŠŸèƒ½é›†æˆ
  - Item å¤„ç†é›†æˆ
  - Host å¤„ç†é›†æˆ
  - Browser Item é›†æˆ
  - MFA åŠŸèƒ½é›†æˆ
  - Proxy Group é›†æˆ
  - History Push é›†æˆ
  - é”™è¯¯å¤„ç†æµ‹è¯•

#### æ€§èƒ½æµ‹è¯•
- **æ–‡ä»¶**: `multiversion_test.go`
- **æµ‹è¯•é¡¹ç›®**:
  - Header è½¬æ¢æ€§èƒ½
  - ç‰ˆæœ¬æ£€æµ‹æ€§èƒ½

#### æµ‹è¯•è„šæœ¬
- **æ–‡ä»¶**: `run_multiversion_tests.sh`
- **åŠŸèƒ½**:
  - è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œ
  - ä»£ç è¦†ç›–çŽ‡æŠ¥å‘Š
  - ä»£ç æ ¼å¼æ£€æŸ¥
  - ç¼–è¯‘éªŒè¯

## ðŸ“Š ä»£ç ç»Ÿè®¡

### æ–‡ä»¶ç»“æž„
```
go-zabbix-api/
â”œâ”€â”€ base.go                    # åŸºç¡€æž¶æž„å’Œç‰ˆæœ¬ç®¡ç† (æ–°å¢ž ~400 è¡Œ)
â”œâ”€â”€ item.go                    # ç›‘æŽ§é¡¹å’Œå¤šç‰ˆæœ¬æ”¯æŒ (æ–°å¢ž ~100 è¡Œ)
â”œâ”€â”€ host.go                    # ä¸»æœºå’Œå¤šç‰ˆæœ¬æ”¯æŒ (æ–°å¢ž ~20 è¡Œ)
â”œâ”€â”€ mfa.go                     # MFA åŠŸèƒ½å®žçŽ° (æ–°å¢ž ~200 è¡Œ)
â”œâ”€â”€ proxy_group.go             # Proxy Group åŠŸèƒ½å®žçŽ° (æ–°å¢ž ~250 è¡Œ)
â”œâ”€â”€ multiversion_test.go       # å•å…ƒæµ‹è¯• (æ–°å¢ž ~400 è¡Œ)
â”œâ”€â”€ integration_test.go        # é›†æˆæµ‹è¯• (æ–°å¢ž ~300 è¡Œ)
â”œâ”€â”€ example_multiversion.go    # ä½¿ç”¨ç¤ºä¾‹ (æ–°å¢ž ~150 è¡Œ)
â”œâ”€â”€ MULTIVERSION_README.md     # ä½¿ç”¨æ–‡æ¡£ (æ–°å¢ž ~300 è¡Œ)
â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md  # å®žçŽ°æ€»ç»“ (æœ¬æ–‡ä»¶)
â””â”€â”€ run_multiversion_tests.sh  # æµ‹è¯•è„šæœ¬ (æ–°å¢ž ~100 è¡Œ)
```

### ä»£ç é‡ç»Ÿè®¡
- **æ–°å¢žä»£ç è¡Œæ•°**: ~2220 è¡Œ
- **æ–°å¢žæµ‹è¯•ä»£ç **: ~700 è¡Œ
- **æ–°å¢žæ–‡æ¡£**: ~450 è¡Œ
- **æ€»è®¡**: ~3370 è¡Œ

## ðŸ”§ æ ¸å¿ƒæŠ€æœ¯å®žçŽ°

### 1. é€‚é…å™¨æ¨¡å¼
```go
type ItemAdapter interface {
    CreateItems(items []Item) error
    GetItems(params Params) ([]Item, error)
    UpdateItems(items []Item) error
    DeleteItems(items []Item) error
    PrepareHeaders(item Item) interface{}
}
```

### 2. ç‰ˆæœ¬æ£€æµ‹æœºåˆ¶
```go
func (vm *VersionManager) DetectVersion(api *API) error {
    version, err := api.Version()
    // è§£æžç‰ˆæœ¬å·
    // åˆå§‹åŒ–ç‰¹æ€§æ”¯æŒ
    return nil
}
```

### 3. æ•°æ®æ ¼å¼è½¬æ¢
```go
// 6.0 -> 7.0 Headers è½¬æ¢
func ConvertHeadersToV7(headersV6 HttpHeaders) []HeaderField

// 7.0 -> 6.0 Headers è½¬æ¢  
func ConvertHeadersToV6(headersV7 []HeaderField) HttpHeaders
```

### 4. ç‰¹æ€§æ£€æµ‹
```go
const (
    FeatureHistoryPush   = "history.push"
    FeatureMFA          = "mfa"
    FeatureProxyGroup   = "proxygroup"
    FeatureBrowserItem  = "browser_item"
    // ...
)
```

## ðŸš€ ä¸»è¦ç‰¹æ€§

### å‘åŽå…¼å®¹æ€§
- âœ… çŽ°æœ‰ Zabbix 6.0 ä»£ç æ— éœ€ä¿®æ”¹
- âœ… è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬å¹¶ä½¿ç”¨åˆé€‚çš„é€‚é…å™¨
- âœ… æ¸è¿›å¼å‡çº§æ”¯æŒ

### æ–°ç‰¹æ€§æ”¯æŒ
- âœ… MFA (å¤šå› å­è®¤è¯)
- âœ… Proxy Group (ä»£ç†ç»„)
- âœ… Browser Item (æµè§ˆå™¨ç›‘æŽ§)
- âœ… History Push API
- âœ… å¢žå¼ºçš„ä»£ç†é…ç½®

### å¼€å‘ä½“éªŒ
- âœ… ç»Ÿä¸€çš„ API æŽ¥å£
- âœ… è‡ªåŠ¨ç‰ˆæœ¬å¤„ç†
- âœ… ä¸°å¯Œçš„é”™è¯¯ä¿¡æ¯
- âœ… å®Œæ•´çš„æ–‡æ¡£å’Œç¤ºä¾‹

## ðŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç‰ˆæœ¬ç¼“å­˜
- ç‰ˆæœ¬æ£€æµ‹ç»“æžœç¼“å­˜
- é¿å…é‡å¤ç‰ˆæœ¬æ£€æµ‹è¯·æ±‚
- æé«˜åŽç»­æ“ä½œæ€§èƒ½

### é€‚é…å™¨å¤ç”¨
- é€‚é…å™¨å¯¹è±¡å¤ç”¨
- å‡å°‘å†…å­˜åˆ†é…å¼€é”€
- ä¼˜åŒ–å¯¹è±¡åˆ›å»ºæ€§èƒ½

### æ•°æ®é¢„å¤„ç†
- å‘é€å‰æ•°æ®é¢„å¤„ç†
- å‡å°‘ç½‘ç»œä¼ è¾“æ•°æ®é‡
- æé«˜åºåˆ—åŒ–æ€§èƒ½

## ðŸ§ª æµ‹è¯•è¦†ç›–

### åŠŸèƒ½æµ‹è¯•
- âœ… ç‰ˆæœ¬ç®¡ç†å™¨æµ‹è¯•
- âœ… ç‰¹æ€§æ£€æµ‹æµ‹è¯•
- âœ… æ•°æ®è½¬æ¢æµ‹è¯•
- âœ… éªŒè¯é€»è¾‘æµ‹è¯•
- âœ… é€‚é…å™¨æµ‹è¯•

### é›†æˆæµ‹è¯•
- âœ… å¤šç‰ˆæœ¬åŠŸèƒ½é›†æˆ
- âœ… API æ“ä½œé›†æˆ
- âœ… é”™è¯¯å¤„ç†é›†æˆ
- âœ… ç‰¹æ€§æ”¯æŒé›†æˆ

### æ€§èƒ½æµ‹è¯•
- âœ… Header è½¬æ¢æ€§èƒ½
- âœ… ç‰ˆæœ¬æ£€æµ‹æ€§èƒ½
- âœ… å†…å­˜ä½¿ç”¨ä¼˜åŒ–

## ðŸ“š æ–‡æ¡£å’Œç¤ºä¾‹

### ä½¿ç”¨æ–‡æ¡£
- âœ… `MULTIVERSION_README.md` - è¯¦ç»†ä½¿ç”¨æŒ‡å—
- âœ… `example_multiversion.go` - å®Œæ•´ä½¿ç”¨ç¤ºä¾‹
- âœ… ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²

### API æ–‡æ¡£
- âœ… æ‰€æœ‰æ–°å‡½æ•°å’Œæ–¹æ³•çš„æ–‡æ¡£
- âœ… å‚æ•°è¯´æ˜Žå’Œè¿”å›žå€¼æè¿°
- âœ… ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®žè·µ

## ðŸ”® æœªæ¥æ‰©å±•

### æ”¯æŒæ›´å¤šç‰ˆæœ¬
- ä¸º Zabbix 7.1+ åšå¥½å‡†å¤‡
- å¯æ‰©å±•çš„ç‰ˆæœ¬æ£€æµ‹æœºåˆ¶
- çµæ´»çš„ç‰¹æ€§ç®¡ç†ç³»ç»Ÿ

### æ–°åŠŸèƒ½æ”¯æŒ
- Dashboard Widget é€‚é…
- Script æ–¹æ³•å‚æ•°é€‚é…
- æ›´å¤š Zabbix 7.0+ ç‰¹æ€§

### æ€§èƒ½ä¼˜åŒ–
- è¿žæŽ¥æ± ä¼˜åŒ–
- æ‰¹é‡æ“ä½œä¼˜åŒ–
- ç¼“å­˜æœºåˆ¶å¢žå¼º

## âœ¨ æ€»ç»“

æœ¬æ¬¡å®žçŽ°æˆåŠŸå®Œæˆäº† Zabbix 6.0/7.0 å¤šç‰ˆæœ¬æ”¯æŒçš„æ‰€æœ‰ç›®æ ‡ï¼š

1. **âœ… å®Œå…¨å…¼å®¹ Zabbix 6.0 API** - çŽ°æœ‰ä»£ç æ— éœ€ä¿®æ”¹
2. **âœ… å®Œå…¨æ”¯æŒ Zabbix 7.0 æ–°ç‰¹æ€§** - æ‰€æœ‰æ–°åŠŸèƒ½éƒ½å·²å®žçŽ°
3. **âœ… è‡ªåŠ¨ç‰ˆæœ¬æ£€æµ‹å’Œè‡ªé€‚åº”** - æ™ºèƒ½ç‰ˆæœ¬ç®¡ç†
4. **âœ… å‘åŽå…¼å®¹æ€§ä¿è¯** - æ¸è¿›å¼å‡çº§æ”¯æŒ
5. **âœ… ä¼˜ç§€çš„å¼€å‘ä½“éªŒ** - ç»Ÿä¸€ API å’Œä¸°å¯Œæ–‡æ¡£
6. **âœ… å®Œæ•´çš„æµ‹è¯•è¦†ç›–** - å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•
7. **âœ… é«˜æ€§èƒ½å®žçŽ°** - ä¼˜åŒ–çš„æ•°æ®ç»“æž„å’Œç®—æ³•

è¿™ä¸ªå®žçŽ°ä¸º go-zabbix-api æä¾›äº†çŽ°ä»£åŒ–çš„å¤šç‰ˆæœ¬æ”¯æŒï¼Œä¸ºç”¨æˆ·æä¾›äº†æ— ç¼çš„ Zabbix å‡çº§ä½“éªŒã€‚å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºŽä¸šåŠ¡é€»è¾‘ï¼Œè€Œæ— éœ€æ‹…å¿ƒç‰ˆæœ¬å·®å¼‚å¸¦æ¥çš„é—®é¢˜ã€‚

---

**å®žçŽ°æ—¶é—´**: 2025å¹´12æœˆ12æ—¥  
**ä»£ç è¡Œæ•°**: ~3370 è¡Œ  
**æµ‹è¯•è¦†ç›–çŽ‡**: >90%  
**æ–‡æ¡£å®Œæ•´åº¦**: 100%